---
import ContactInfo from "../components/ContactInfo.astro";

interface Props {
  openingHours: { days: string; hours: string };
}

const { openingHours } = Astro.props;
---

<section id="kontakt" class="contact-section">
  <div class="container">
    <h2
      class="section-title glass-card-gradient"
      style="--shimmer-delay: 0.4s; --shimmer-duration: 3.5s;"
    >
      Kontakt
    </h2>
    <p class="text-center text-muted">Máte dotaz? Neváhejte nás kontaktovat</p>

    <div class="contact-grid">
      <ContactInfo openingHours={openingHours} />

      <div class="contact-form-wrapper glass-card">
        <h3>Kontaktní formulář</h3>
        <p class="form-note">Formulář bude implementován v dalším kroku</p>
        <div class="form-placeholder">
          <p>Kontaktní formulář</p>
          <p class="text-muted">
            Zatím nás můžete kontaktovat přímo telefonicky nebo e-mailem.
          </p>
        </div>
      </div>
    </div>

    <div class="map-container glass-card">
      <h3>Jak nás najdete</h3>
      <div class="map-wrapper" id="google-map-wrapper">
        <div class="map-loading">
          <div class="spinner"></div>
        </div>
        <iframe
          data-src="https://www.google.com/maps/embed?pb=!1m17!1m12!1m3!1d2595.6847193847195!2d17.47476!3d49.44775!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zNDnCsDI2JzUxLjkiTiAxN8KwMjgnMjkuMSJF!5e0!3m2!1scs!2scz!4v1732224000000!5m2!1scs!2scz"
          width="100%"
          height="450"
          style="border:0;"
          allowfullscreen=""
          referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </div>
  </div>
</section>

<script>
  const mapWrapper = document.getElementById("google-map-wrapper");

  if (mapWrapper) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const iframe = mapWrapper.querySelector(
              "iframe"
            ) as HTMLIFrameElement;
            const loading = mapWrapper.querySelector(
              ".map-loading"
            ) as HTMLElement;

            if (iframe?.dataset.src) {
              iframe.src = iframe.dataset.src;
              iframe.onload = () => {
                if (loading) loading.style.display = "none";
              };
              iframe.removeAttribute("data-src");
            }

            observer.unobserve(mapWrapper);
          }
        });
      },
      { rootMargin: "800px" }
    );

    observer.observe(mapWrapper);
  }
</script>

<style>
  .map-wrapper {
    position: relative;
    background: rgba(219, 226, 239, 0.1);
    min-height: 450px;
  }

  .map-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(63, 114, 175, 0.2);
    border-radius: 50%;
    border-top-color: var(--accent-primary);
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
</style>
